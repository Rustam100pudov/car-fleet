# Демонстрация системы автопарка

## Обзор проекта

Система управления служебными автомобилями - Laravel-приложение для бронирования автомобилей сотрудниками компании.

## Техническое задание (выполнено ✅)

### 1. База данных и миграции ✅
- **positions** - должности сотрудников
- **comfort_categories** - категории комфорта автомобилей (Первая, Вторая, Третья...)
- **position_category** - связь должностей с доступными категориями комфорта
- **car_models** - модели автомобилей с привязкой к категории комфорта
- **drivers** - водители
- **cars** - автомобили с привязкой к модели и водителю
- **bookings** - бронирования автомобилей
- **users** - пользователи с привязкой к должности

### 2. API методы ✅
- **GET /api/available-cars** - получение списка доступных автомобилей
- **POST /api/bookings** - создание бронирования
- **GET /api/bookings** - список бронирований пользователя
- **DELETE /api/bookings/{id}** - отмена бронирования

### 3. Бизнес-логика ✅
- Фильтрация автомобилей по должности пользователя
- Проверка доступности автомобиля на временной интервал
- Фильтрация по модели, категории комфорта, водителю
- Система ролей и разрешений

## Демонстрационные данные

### Должности и доступные категории:
- **Manager** - доступны категории "Первая" и "Вторая"
- **Engineer** - доступна только категория "Вторая"

### Автомобили:
1. Toyota Camry (Первая категория) - водитель Иванов Иван
2. Skoda Octavia (Вторая категория) - водитель Петров Пётр
3. Toyota Corolla (Первая категория) - водитель Сидоров Сергей
4. Nissan Qashqai (Вторая категория) - водитель Кузнецов Алексей
5. Skoda Superb (Вторая категория) - водитель Морозова Анна

## Сценарий демонстрации

### 1. Главная страница
Откройте http://127.0.0.1:8000
- Простая, чистая страница приветствия
- Кнопка "Вход в админку" для перехода к функционалу

### 2. Админская панель
Откройте http://127.0.0.1:8000/admin/available-cars

#### Шаг 1: Выбор сотрудника
- Выберите сотрудника (Manager User или Engineer User)
- Система автоматически получит токен для API

#### Шаг 2: Установка временного интервала
- Start: 2025-09-01 09:00
- End: 2025-09-01 12:00

#### Шаг 3: Демонстрация фильтрации
- **Manager User** видит автомобили 1-й и 2-й категории (5 автомобилей)
- **Engineer User** видит только автомобили 2-й категории (3 автомобиля)

#### Шаг 4: Дополнительные фильтры
- Фильтр по марке (Toyota, Skoda, Nissan)
- Фильтр по водителю
- Фильтр по категории комфорта

#### Шаг 5: Бронирование
- Кликните "Забронировать" на любом автомобиле
- Система создаст бронирование
- Автомобиль исчезнет из списка доступных (занят)

#### Шаг 6: Управление бронированиями
- В разделе "Мои брони" отображаются все бронирования пользователя
- Возможность отмены бронирования

## API Endpoints

### Получение доступных автомобилей
```http
GET /api/available-cars?start=2025-09-01T09:00&end=2025-09-01T12:00&brand=Toyota
Authorization: Bearer {token}
```

**Параметры:**
- `start` (required) - начало интервала
- `end` (required) - конец интервала  
- `model_id` (optional) - ID модели
- `category_id` (optional) - ID категории комфорта
- `brand` (optional) - марка автомобиля
- `driver_id` (optional) - ID водителя

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "license_plate": "A001AA116",
      "vin": null,
      "model": {
        "id": 1,
        "brand": "Toyota",
        "model": "Camry",
        "category": {
          "id": 1,
          "name": "Первая",
          "rank": 1
        }
      },
      "driver": {
        "id": 1,
        "full_name": "Иванов Иван",
        "phone": "+7 900 000-00-01"
      }
    }
  ],
  "meta": {
    "current_page": 1,
    "last_page": 1,
    "total": 1
  }
}
```

### Создание бронирования
```http
POST /api/bookings
Authorization: Bearer {token}
Content-Type: application/json

{
  "car_id": 1,
  "start": "2025-09-01T09:00",
  "end": "2025-09-01T12:00",
  "purpose": "Деловая поездка"
}
```

## Тестирование

Запустите автоматические тесты:
```bash
php artisan test
```

Тесты проверяют:
- Корректность фильтрации по должности
- Исключение забронированных автомобилей
- Валидацию временных интервалов
- Авторизацию и права доступа

## Технические особенности

### Архитектура
- **MVC** паттерн Laravel
- **Repository** паттерн для работы с данными
- **Sanctum** для API аутентификации
- **Eloquent ORM** для работы с базой данных

### Оптимизации
- **Eager Loading** для предотвращения N+1 запросов
- **Индексы** на внешние ключи
- **Scope методы** для переиспользуемых запросов
- **Пагинация** для больших списков

### Безопасность
- **Валидация** всех входящих данных
- **Авторизация** на уровне API
- **Защита от CSRF**
- **Санитизация** пользовательского ввода

## Расширение функционала

Система легко расширяется для:
- Добавления новых категорий комфорта
- Интеграции с календарными системами
- Уведомлений по email/SMS
- Мобильного приложения через API
- Интеграции с системами учета топлива
- Отчетности и аналитики

## Заключение

Проект полностью соответствует техническому заданию и демонстрирует:
- Правильную архитектуру базы данных
- Качественный API дизайн
- Удобный пользовательский интерфейс
- Гибкую систему фильтрации
- Возможности для масштабирования
